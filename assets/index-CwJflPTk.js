import{a as He,r as f,B as ae,X as Ye,I as je,w as Qe,d as r,F as oe,o as u,c as $,e as l,f as t,n as k,g as a,C as L,G as y,i as ne,J as T,K as D,t as d,j as b,H as se,l as h,y as ue,A as Ge,q as Je}from"./index-Br2HtEUP.js";import{d as Xe,l as We,b as Ze,e as el,c as ll,r as tl,f as re,h as al,i as ol}from"./user-Cm8EuaVr.js";import{e as de}from"./jsencrypt-DEwj1mID.js";import{d as nl}from"./export-DRQPRSom.js";const sl={class:"app-container"},ul={class:"head-container"},rl={class:"head-container"},dl={class:"dialog-footer"},il=k("div",{class:"el-upload__text"},[b("将文件拖到此处，或"),k("em",null,"点击上传")],-1),pl={class:"el-upload__tip text-center"},ml={class:"el-upload__tip"},cl=k("span",null,"仅允许导入xls、xlsx格式文件。",-1),fl={class:"dialog-footer"},_l=Ge({name:"User"}),kl=Object.assign(_l,{setup(vl){const ie=He(),{proxy:p}=Je(),{sys_normal_disable:G,sys_user_sex:pe}=p.useDict("sys_normal_disable","sys_user_sex"),J=f([]),w=f(!1),O=f(!0),P=f(!0),F=f([]),X=f(!0),W=f(!0),z=f(0),M=f(""),N=f([]),q=f(""),A=f(void 0),me=f(void 0),H=f([]),Y=f([]),g=ae({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Ye()},url:"/ruoyi/system/user/importData"}),x=f([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),ce=ae({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:_,form:s,rules:fe}=je(ce),_e=(n,o)=>n?o.label.indexOf(n)!==-1:!0;Qe(q,n=>{p.$refs.deptTreeRef.filter(n)});function ve(){Xe().then(n=>{A.value=n.data})}function I(){O.value=!0,We({..._.value,startTime:N.value[0],endTime:N.value[1]}).then(n=>{O.value=!1,J.value=n.rows,z.value=n.total})}function be(n){_.value.deptId=n.id,R()}function R(){_.value.pageNum=1,I()}function ge(){N.value=[],p.resetForm("queryRef"),_.value.deptId=void 0,p.$refs.deptTreeRef.setCurrentKey(null),R()}function Z(n){const o=n.userId||F.value;p.$modal.confirm('是否确认删除用户编号为"'+o+'"的数据项？').then(function(){return Ze(o)}).then(()=>{I(),p.$modal.msgSuccess("删除成功")}).catch(()=>{})}async function he(){let n={};F.value.forEach((i,Q)=>{n[Q]=i});let o=await el(n);nl(o)}function ye(n){let o=n.status==="0"?"启用":"停用";p.$modal.confirm('确认要"'+o+'""'+n.userName+'"用户吗?').then(function(){return ll(n.userId,n.status)}).then(()=>{p.$modal.msgSuccess(o+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function ke(n){const o=n.userId;ie.push("/system/user-auth/role/"+o)}function Ve(n){p.$prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:o=>{if(/<|>|"|'|\||\\/.test(o))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:o})=>{tl(n.userId,de(o)).then(i=>{p.$modal.msgSuccess("修改成功，新密码是："+o)})}).catch(()=>{})}function we(n){F.value=n.map(o=>o.userId),X.value=n.length!=1,W.value=!n.length}function xe(){p.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const Ie=(n,o,i)=>{g.isUploading=!0},Ue=(n,o,i)=>{g.open=!1,g.isUploading=!1,p.$refs.uploadRef.handleRemove(o),p.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),I()};function Ce(){p.$refs.uploadRef.submit()}function j(){s.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},p.resetForm("userRef")}function Ne(){w.value=!1,j()}function Se(){j(),re().then(n=>{H.value=n.posts,Y.value=n.roles,w.value=!0,M.value="添加用户",s.value.password=me.value})}function ee(n){j();const o=n.userId||F.value;re(o).then(i=>{s.value=i.data,H.value=i.posts,Y.value=i.roles,s.value.postIds=i.postIds,s.value.roleIds=i.roleIds,w.value=!0,M.value="修改用户",s.password=""})}function $e(){p.$refs.userRef.validate(n=>{n&&(s.value.userId!=null?al(s.value).then(o=>{p.$modal.msgSuccess("修改成功"),w.value=!1,I()}):(s.value.password=de(s.value.password),ol(s.value).then(o=>{p.$modal.msgSuccess("新增成功"),w.value=!1,I()})))})}return ve(),I(),(n,o)=>{const i=r("el-input"),Q=r("el-tree"),m=r("el-col"),c=r("el-form-item"),B=r("el-option"),K=r("el-select"),Re=r("el-date-picker"),v=r("el-button"),le=r("el-form"),Te=r("right-toolbar"),U=r("el-row"),V=r("el-table-column"),De=r("el-switch"),E=r("el-tooltip"),Pe=r("el-table"),Fe=r("pagination"),qe=r("el-tree-select"),Be=r("el-radio"),Ke=r("el-radio-group"),te=r("el-dialog"),Ee=r("upload-filled"),Le=r("el-icon"),Oe=r("el-checkbox"),ze=r("el-link"),Me=r("el-upload"),C=oe("hasPermi"),Ae=oe("loading");return u(),$("div",sl,[l(U,{gutter:20},{default:t(()=>[l(m,{span:4,xs:24},{default:t(()=>[k("div",ul,[l(i,{modelValue:a(q),"onUpdate:modelValue":o[0]||(o[0]=e=>L(q)?q.value=e:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),k("div",rl,[l(Q,{data:a(A),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":_e,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:be},null,8,["data"])])]),_:1}),l(m,{span:20,xs:24},{default:t(()=>[y(l(le,{model:a(_),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(c,{label:"用户名称",prop:"userName"},{default:t(()=>[l(i,{modelValue:a(_).userName,"onUpdate:modelValue":o[1]||(o[1]=e=>a(_).userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:ne(R,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(c,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(i,{modelValue:a(_).phonenumber,"onUpdate:modelValue":o[2]||(o[2]=e=>a(_).phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:ne(R,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(c,{label:"状态",prop:"status"},{default:t(()=>[l(K,{modelValue:a(_).status,"onUpdate:modelValue":o[3]||(o[3]=e=>a(_).status=e),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:t(()=>[(u(!0),$(T,null,D(a(G),e=>(u(),d(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"创建时间",style:{width:"308px"}},{default:t(()=>[l(Re,{modelValue:a(N),"onUpdate:modelValue":o[4]||(o[4]=e=>L(N)?N.value=e:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(c,null,{default:t(()=>[l(v,{type:"primary",icon:"Search",onClick:R},{default:t(()=>[b("搜索")]),_:1}),l(v,{icon:"Refresh",onClick:ge},{default:t(()=>[b("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[se,a(P)]]),l(U,{gutter:10,class:"mb8"},{default:t(()=>[l(m,{span:1.5},{default:t(()=>[y((u(),d(v,{type:"primary",plain:"",icon:"Plus",onClick:Se},{default:t(()=>[b("新增")]),_:1})),[[C,["system:user:add"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((u(),d(v,{type:"success",plain:"",icon:"Edit",disabled:a(X),onClick:ee},{default:t(()=>[b("修改")]),_:1},8,["disabled"])),[[C,["system:user:edit"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((u(),d(v,{type:"danger",plain:"",icon:"Delete",disabled:a(W),onClick:Z},{default:t(()=>[b("删除")]),_:1},8,["disabled"])),[[C,["system:user:remove"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((u(),d(v,{type:"warning",plain:"",icon:"Download",onClick:he},{default:t(()=>[b("导出")]),_:1})),[[C,["system:user:export"]]])]),_:1}),l(Te,{showSearch:a(P),"onUpdate:showSearch":o[5]||(o[5]=e=>L(P)?P.value=e:null),onQueryTable:I,columns:a(x)},null,8,["showSearch","columns"])]),_:1}),y((u(),d(Pe,{data:a(J),onSelectionChange:we},{default:t(()=>[l(V,{type:"selection",width:"50",align:"center"}),a(x)[0].visible?(u(),d(V,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):h("",!0),a(x)[1].visible?(u(),d(V,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):h("",!0),a(x)[2].visible?(u(),d(V,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):h("",!0),a(x)[3].visible?(u(),d(V,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):h("",!0),a(x)[4].visible?(u(),d(V,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):h("",!0),a(x)[5].visible?(u(),d(V,{label:"状态",align:"center",key:"status"},{default:t(e=>[l(De,{modelValue:e.row.status,"onUpdate:modelValue":S=>e.row.status=S,"active-value":"0","inactive-value":"1",onChange:S=>ye(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):h("",!0),a(x)[6].visible?(u(),d(V,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(e=>[k("span",null,ue(n.parseTime(e.row.createTime)),1)]),_:1})):h("",!0),l(V,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:t(e=>[e.row.userId!==1?(u(),d(E,{key:0,content:"修改",placement:"top"},{default:t(()=>[y(l(v,{link:"",type:"primary",icon:"Edit",onClick:S=>ee(e.row)},null,8,["onClick"]),[[C,["system:user:edit"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(u(),d(E,{key:1,content:"删除",placement:"top"},{default:t(()=>[y(l(v,{link:"",type:"primary",icon:"Delete",onClick:S=>Z(e.row)},null,8,["onClick"]),[[C,["system:user:remove"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(u(),d(E,{key:2,content:"重置密码",placement:"top"},{default:t(()=>[y(l(v,{link:"",type:"primary",icon:"Key",onClick:S=>Ve(e.row)},null,8,["onClick"]),[[C,["system:user:resetPwd"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(u(),d(E,{key:3,content:"分配角色",placement:"top"},{default:t(()=>[y(l(v,{link:"",type:"primary",icon:"CircleCheck",onClick:S=>ke(e.row)},null,8,["onClick"]),[[C,["system:user:edit"]]])]),_:2},1024)):h("",!0)]),_:1})]),_:1},8,["data"])),[[Ae,a(O)]]),y(l(Fe,{total:a(z),page:a(_).pageNum,"onUpdate:page":o[6]||(o[6]=e=>a(_).pageNum=e),limit:a(_).pageSize,"onUpdate:limit":o[7]||(o[7]=e=>a(_).pageSize=e),onPagination:I},null,8,["total","page","limit"]),[[se,a(z)>0]])]),_:1})]),_:1}),l(te,{title:a(M),modelValue:a(w),"onUpdate:modelValue":o[19]||(o[19]=e=>L(w)?w.value=e:null),width:"600px","append-to-body":""},{footer:t(()=>[k("div",dl,[l(v,{type:"primary",onClick:$e},{default:t(()=>[b("确 定")]),_:1}),l(v,{onClick:Ne},{default:t(()=>[b("取 消")]),_:1})])]),default:t(()=>[l(le,{model:a(s),rules:a(fe),ref:"userRef","label-width":"80px"},{default:t(()=>[l(U,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(c,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(i,{modelValue:a(s).nickName,"onUpdate:modelValue":o[8]||(o[8]=e=>a(s).nickName=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(c,{label:"归属部门",prop:"deptId"},{default:t(()=>[l(qe,{modelValue:a(s).deptId,"onUpdate:modelValue":o[9]||(o[9]=e=>a(s).deptId=e),data:a(A),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(c,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(i,{modelValue:a(s).phonenumber,"onUpdate:modelValue":o[10]||(o[10]=e=>a(s).phonenumber=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(c,{label:"邮箱",prop:"email"},{default:t(()=>[l(i,{modelValue:a(s).email,"onUpdate:modelValue":o[11]||(o[11]=e=>a(s).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[a(s).userId==null?(u(),d(c,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[l(i,{modelValue:a(s).userName,"onUpdate:modelValue":o[12]||(o[12]=e=>a(s).userName=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1}),l(m,{span:12},{default:t(()=>[a(s).userId==null?(u(),d(c,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(i,{modelValue:a(s).password,"onUpdate:modelValue":o[13]||(o[13]=e=>a(s).password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(c,{label:"用户性别"},{default:t(()=>[l(K,{modelValue:a(s).sex,"onUpdate:modelValue":o[14]||(o[14]=e=>a(s).sex=e),placeholder:"请选择"},{default:t(()=>[(u(!0),$(T,null,D(a(pe),e=>(u(),d(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(c,{label:"状态"},{default:t(()=>[l(Ke,{modelValue:a(s).status,"onUpdate:modelValue":o[15]||(o[15]=e=>a(s).status=e)},{default:t(()=>[(u(!0),$(T,null,D(a(G),e=>(u(),d(Be,{key:e.value,label:e.value},{default:t(()=>[b(ue(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(c,{label:"岗位"},{default:t(()=>[l(K,{modelValue:a(s).postIds,"onUpdate:modelValue":o[16]||(o[16]=e=>a(s).postIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(u(!0),$(T,null,D(a(H),e=>(u(),d(B,{key:e.postId,label:e.postName,value:e.postId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(c,{label:"角色"},{default:t(()=>[l(K,{modelValue:a(s).roleIds,"onUpdate:modelValue":o[17]||(o[17]=e=>a(s).roleIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(u(!0),$(T,null,D(a(Y),e=>(u(),d(B,{key:e.roleId,label:e.roleName,value:e.roleId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(m,{span:24},{default:t(()=>[l(c,{label:"备注"},{default:t(()=>[l(i,{modelValue:a(s).remark,"onUpdate:modelValue":o[18]||(o[18]=e=>a(s).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(te,{title:a(g).title,modelValue:a(g).open,"onUpdate:modelValue":o[22]||(o[22]=e=>a(g).open=e),width:"400px","append-to-body":""},{footer:t(()=>[k("div",fl,[l(v,{type:"primary",onClick:Ce},{default:t(()=>[b("确 定")]),_:1}),l(v,{onClick:o[21]||(o[21]=e=>a(g).open=!1)},{default:t(()=>[b("取 消")]),_:1})])]),default:t(()=>[l(Me,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:a(g).headers,action:a(g).url+"?updateSupport="+a(g).updateSupport,disabled:a(g).isUploading,"on-progress":Ie,"on-success":Ue,"auto-upload":!1,drag:""},{tip:t(()=>[k("div",pl,[k("div",ml,[l(Oe,{modelValue:a(g).updateSupport,"onUpdate:modelValue":o[20]||(o[20]=e=>a(g).updateSupport=e)},null,8,["modelValue"]),b("是否更新已经存在的用户数据 ")]),cl,l(ze,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:xe},{default:t(()=>[b("下载模板")]),_:1})])]),default:t(()=>[l(Le,{class:"el-icon--upload"},{default:t(()=>[l(Ee)]),_:1}),il]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{kl as default};
